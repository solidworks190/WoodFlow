<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>🔧 WoodFlow - لوحة التحكم الشاملة</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff; 
      font-family: system-ui, -apple-system, 'Segoe UI', Arial, sans-serif; 
      margin: 0; 
      padding: 20px;
      min-height: 100vh;
    }
    .container { 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: 0 16px; 
    }
    .hero { 
      text-align: center; 
      padding: 40px 0; 
      background: rgba(255,255,255,0.1); 
      border-radius: 20px; 
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
    }
    .hero h1 { 
      font-size: 48px; 
      margin: 0 0 10px 0; 
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    .hero p { 
      font-size: 18px; 
      opacity: 0.9; 
      margin: 0;
    }
    .grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
      gap: 20px; 
      margin-top: 30px;
    }
    .card { 
      background: rgba(255,255,255,0.15); 
      border: 1px solid rgba(255,255,255,0.2); 
      border-radius: 15px; 
      padding: 25px; 
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.2);
    }
    .card h3 { 
      margin: 0 0 15px 0; 
      font-size: 22px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .status-indicator { 
      width: 12px; 
      height: 12px; 
      border-radius: 50%; 
      display: inline-block;
      margin-left: 8px;
    }
    .status-online { background: #00ff88; box-shadow: 0 0 10px #00ff88; }
    .status-offline { background: #ff4757; }
    .status-loading { background: #ffa502; animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .btn { 
      display: inline-flex; 
      align-items: center; 
      gap: 8px; 
      padding: 12px 20px; 
      border-radius: 10px; 
      border: none; 
      background: rgba(255,255,255,0.2); 
      color: #fff; 
      cursor: pointer; 
      text-decoration: none;
      font-size: 14px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    .btn:hover { 
      background: rgba(255,255,255,0.3); 
      transform: translateY(-2px);
    }
    .btn-primary { 
      background: linear-gradient(45deg, #ff6b6b, #ee5a24); 
    }
    .btn-primary:hover { 
      background: linear-gradient(45deg, #ee5a24, #ff6b6b); 
    }
    input[type="url"] { 
      width: 100%; 
      padding: 12px 15px; 
      border-radius: 10px; 
      border: 1px solid rgba(255,255,255,0.3); 
      background: rgba(255,255,255,0.1); 
      color: #fff; 
      font-size: 14px;
      backdrop-filter: blur(10px);
    }
    input[type="url"]::placeholder { color: rgba(255,255,255,0.7); }
    input[type="url"]:focus { 
      outline: none; 
      border-color: #00ff88; 
      box-shadow: 0 0 20px rgba(0,255,136,0.3);
    }
    .info-grid { 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 15px; 
      margin-top: 15px;
    }
    .info-item { 
      padding: 10px; 
      background: rgba(0,0,0,0.2); 
      border-radius: 8px;
      font-size: 14px;
    }
    .info-label { 
      opacity: 0.8; 
      font-size: 12px; 
      margin-bottom: 5px;
    }
    .info-value { 
      font-weight: bold; 
      font-size: 16px;
    }
    .qr-container { 
      text-align: center; 
      padding: 20px;
    }
    .qr-container img { 
      border-radius: 10px; 
      background: #fff; 
      padding: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    .links-section a { 
      display: block; 
      padding: 8px 12px; 
      margin: 5px 0; 
      background: rgba(0,0,0,0.2); 
      border-radius: 8px; 
      color: #fff; 
      text-decoration: none;
      font-family: monospace;
      transition: all 0.3s ease;
    }
    .links-section a:hover { 
      background: rgba(0,0,0,0.4); 
      transform: translateX(5px);
    }
    .footer { 
      text-align: center; 
      padding: 30px 0; 
      opacity: 0.8;
    }
    .loading { opacity: 0.6; pointer-events: none; }
    
    @media (max-width: 768px) {
      .hero h1 { font-size: 36px; }
      .grid { grid-template-columns: 1fr; }
      .info-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="hero">
      <h1>🔧 WoodFlow</h1>
      <p>لوحة التحكم الشاملة - Powered by Supabase + Vercel</p>
    </div>

    <div class="grid">
      <!-- بطاقة إعداد الخادم -->
      <div class="card">
        <h3>
          🌐 إعداد الخادم
          <span id="serverStatus" class="status-indicator status-loading"></span>
        </h3>
        <div style="margin-bottom: 15px;">
          <input type="url" id="serverUrl" placeholder="https://your-server.vercel.app" />
        </div>
        <div style="display: flex; gap: 10px;">
          <button class="btn btn-primary" id="saveServerBtn">💾 حفظ</button>
          <button class="btn" id="testConnectionBtn">🔍 اختبار</button>
        </div>
        <div id="connectionMessage" style="margin-top: 10px; font-size: 14px;"></div>
      </div>

      <!-- بطاقة حالة النظام -->
      <div class="card">
        <h3>📊 حالة النظام</h3>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">حالة الاتصال</div>
            <div class="info-value" id="connectionStatus">غير متصل</div>
          </div>
          <div class="info-item">
            <div class="info-label">قاعدة البيانات</div>
            <div class="info-value" id="dbStatus">غير معروف</div>
          </div>
          <div class="info-item">
            <div class="info-label">آخر فحص</div>
            <div class="info-value" id="lastCheck">—</div>
          </div>
          <div class="info-item">
            <div class="info-label">وقت التشغيل</div>
            <div class="info-value" id="uptime">—</div>
          </div>
        </div>
      </div>

      <!-- بطاقة الروابط المفيدة -->
      <div class="card">
        <h3>🔗 الروابط المفيدة</h3>
        <div class="links-section">
          <a id="healthLink" href="#" target="_blank">📡 فحص الصحة /api/health</a>
          <a id="syncLink" href="#" target="_blank">🔄 واجهة المزامنة /api/sync</a>
          <a id="viewerLink" href="#" target="_blank">📱 عارض QR /viewer</a>
          <a id="updatesLink" href="#" target="_blank">📦 ملفات التحديث /updates</a>
        </div>
      </div>

      <!-- بطاقة الباركود -->
      <div class="card">
        <h3>📱 باركود الاتصال السريع</h3>
        <div class="qr-container">
          <img id="qrCode" alt="QR Code" width="200" height="200" 
               src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=WoodFlow" />
          <div style="margin-top: 10px; font-size: 14px; opacity: 0.9;">
            امسح الكود لضبط رابط الخادم تلقائياً
          </div>
        </div>
      </div>

      <!-- بطاقة إحصائيات المزامنة -->
      <div class="card">
        <h3>📈 إحصائيات المزامنة</h3>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">المشاريع النشطة</div>
            <div class="info-value" id="activeProjects">—</div>
          </div>
          <div class="info-item">
            <div class="info-label">آخر مزامنة</div>
            <div class="info-value" id="lastSync">—</div>
          </div>
          <div class="info-item">
            <div class="info-label">حجم البيانات</div>
            <div class="info-value" id="dataSize">—</div>
          </div>
          <div class="info-item">
            <div class="info-label">المستخدمين</div>
            <div class="info-value" id="userCount">—</div>
          </div>
        </div>
      </div>

      <!-- بطاقة أدوات سريعة -->
      <div class="card">
        <h3>⚡ أدوات سريعة</h3>
        <div style="display: flex; flex-direction: column; gap: 10px;">
          <button class="btn" id="backupBtn">💾 نسخ احتياطي</button>
          <button class="btn" id="clearCacheBtn">🧹 مسح الكاش</button>
          <button class="btn" id="exportDataBtn">📤 تصدير البيانات</button>
          <button class="btn btn-primary" id="deployUpdatesBtn">🚀 نشر تحديث</button>
        </div>
      </div>
    </div>

    <div class="footer">
      <p>🔧 WoodFlow Control Panel - Built with ❤️ using Supabase & Vercel</p>
      <p style="font-size: 14px; opacity: 0.7;">مجاني 100% • يعمل تلقائياً 24/7 • بدون صيانة</p>
    </div>
  </div>

  <script>
    // سيتم إضافة JavaScript هنا
    console.log('🚀 WoodFlow Control Panel Loading...');
    
    // متغيرات عامة
    let currentServerUrl = localStorage.getItem('woodflow_server_url') || '';
    
    // عناصر DOM
    const serverUrlInput = document.getElementById('serverUrl');
    const saveServerBtn = document.getElementById('saveServerBtn');
    const testConnectionBtn = document.getElementById('testConnectionBtn');
    const serverStatus = document.getElementById('serverStatus');
    const connectionMessage = document.getElementById('connectionMessage');
    
    // تحديث الروابط
    function updateLinks(baseUrl) {
      if (!baseUrl) return;
      
      document.getElementById('healthLink').href = baseUrl + '/api/health';
      document.getElementById('syncLink').href = baseUrl + '/api/sync';
      document.getElementById('viewerLink').href = baseUrl + '/viewer';
      document.getElementById('updatesLink').href = baseUrl + '/updates';
      
      // تحديث QR Code
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(baseUrl)}`;
      document.getElementById('qrCode').src = qrUrl;
    }
    
    // حفظ رابط الخادم
    function saveServerUrl() {
      const url = serverUrlInput.value.trim();
      if (!url) {
        showMessage('يرجى إدخال رابط الخادم', 'error');
        return;
      }
      
      try {
        new URL(url); // تحقق من صحة الرابط
        currentServerUrl = url;
        localStorage.setItem('woodflow_server_url', url);
        updateLinks(url);
        showMessage('تم حفظ الرابط بنجاح', 'success');
        testConnection();
      } catch (e) {
        showMessage('رابط غير صحيح', 'error');
      }
    }
    
    // اختبار الاتصال
    async function testConnection() {
      if (!currentServerUrl) {
        showMessage('لا يوجد رابط خادم محفوظ', 'error');
        return;
      }
      
      serverStatus.className = 'status-indicator status-loading';
      showMessage('جارِ اختبار الاتصال...', 'info');
      
      try {
        const response = await fetch(currentServerUrl + '/api/health', {
          method: 'GET',
          cache: 'no-store'
        });
        
        if (response.ok) {
          const data = await response.json();
          serverStatus.className = 'status-indicator status-online';
          showMessage('✅ الاتصال نجح! الخادم يعمل بشكل طبيعي', 'success');
          updateDashboard(data);
        } else {
          throw new Error('Server returned ' + response.status);
        }
      } catch (error) {
        serverStatus.className = 'status-indicator status-offline';
        showMessage('❌ فشل الاتصال: ' + error.message, 'error');
      }
    }
    
    // تحديث لوحة المعلومات
    function updateDashboard(healthData) {
      document.getElementById('connectionStatus').textContent = 'متصل ✅';
      document.getElementById('dbStatus').textContent = healthData.database || 'يعمل';
      document.getElementById('lastCheck').textContent = new Date().toLocaleTimeString('ar');
      document.getElementById('uptime').textContent = healthData.uptime || 'غير معروف';
    }
    
    // عرض الرسائل
    function showMessage(message, type = 'info') {
      const messageDiv = connectionMessage;
      messageDiv.textContent = message;
      messageDiv.style.color = type === 'error' ? '#ff4757' : 
                               type === 'success' ? '#00ff88' : 
                               '#ffa502';
    }
    
    // ربط الأحداث
    saveServerBtn.addEventListener('click', saveServerUrl);
    testConnectionBtn.addEventListener('click', testConnection);
    serverUrlInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') saveServerUrl();
    });
    
    // تهيئة الصفحة
    function init() {
      if (currentServerUrl) {
        serverUrlInput.value = currentServerUrl;
        updateLinks(currentServerUrl);
        // اختبار تلقائي بعد ثانيتين
        setTimeout(testConnection, 2000);
      }
      
      // فحص دوري كل دقيقة
      setInterval(() => {
        if (currentServerUrl) testConnection();
      }, 60000);
    }
    
    // بدء التطبيق
    init();
    
    console.log('✅ WoodFlow Control Panel Ready!');
  </script>
</body>
</html>