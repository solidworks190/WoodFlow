<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸ”§ WoodFlow - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø©</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff; 
      font-family: system-ui, -apple-system, 'Segoe UI', Arial, sans-serif; 
      margin: 0; 
      padding: 20px;
      min-height: 100vh;
    }
    .container { 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: 0 16px; 
    }
    .hero { 
      text-align: center; 
      padding: 40px 0; 
      background: rgba(255,255,255,0.1); 
      border-radius: 20px; 
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
    }
    .hero h1 { 
      font-size: 48px; 
      margin: 0 0 10px 0; 
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    .hero p { 
      font-size: 18px; 
      opacity: 0.9; 
      margin: 0;
    }
    .grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
      gap: 20px; 
      margin-top: 30px;
    }
    .card { 
      background: rgba(255,255,255,0.15); 
      border: 1px solid rgba(255,255,255,0.2); 
      border-radius: 15px; 
      padding: 25px; 
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.2);
    }
    .card h3 { 
      margin: 0 0 15px 0; 
      font-size: 22px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .status-indicator { 
      width: 12px; 
      height: 12px; 
      border-radius: 50%; 
      display: inline-block;
      margin-left: 8px;
    }
    .status-online { background: #00ff88; box-shadow: 0 0 10px #00ff88; }
    .status-offline { background: #ff4757; }
    .status-loading { background: #ffa502; animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .btn { 
      display: inline-flex; 
      align-items: center; 
      gap: 8px; 
      padding: 12px 20px; 
      border-radius: 10px; 
      border: none; 
      background: rgba(255,255,255,0.2); 
      color: #fff; 
      cursor: pointer; 
      text-decoration: none;
      font-size: 14px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    .btn:hover { 
      background: rgba(255,255,255,0.3); 
      transform: translateY(-2px);
    }
    .btn-primary { 
      background: linear-gradient(45deg, #ff6b6b, #ee5a24); 
    }
    .btn-primary:hover { 
      background: linear-gradient(45deg, #ee5a24, #ff6b6b); 
    }
    input[type="url"] { 
      width: 100%; 
      padding: 12px 15px; 
      border-radius: 10px; 
      border: 1px solid rgba(255,255,255,0.3); 
      background: rgba(255,255,255,0.1); 
      color: #fff; 
      font-size: 14px;
      backdrop-filter: blur(10px);
    }
    input[type="url"]::placeholder { color: rgba(255,255,255,0.7); }
    input[type="url"]:focus { 
      outline: none; 
      border-color: #00ff88; 
      box-shadow: 0 0 20px rgba(0,255,136,0.3);
    }
    .info-grid { 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 15px; 
      margin-top: 15px;
    }
    .info-item { 
      padding: 10px; 
      background: rgba(0,0,0,0.2); 
      border-radius: 8px;
      font-size: 14px;
    }
    .info-label { 
      opacity: 0.8; 
      font-size: 12px; 
      margin-bottom: 5px;
    }
    .info-value { 
      font-weight: bold; 
      font-size: 16px;
    }
    .qr-container { 
      text-align: center; 
      padding: 20px;
    }
    .qr-container img { 
      border-radius: 10px; 
      background: #fff; 
      padding: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    .links-section a { 
      display: block; 
      padding: 8px 12px; 
      margin: 5px 0; 
      background: rgba(0,0,0,0.2); 
      border-radius: 8px; 
      color: #fff; 
      text-decoration: none;
      font-family: monospace;
      transition: all 0.3s ease;
    }
    .links-section a:hover { 
      background: rgba(0,0,0,0.4); 
      transform: translateX(5px);
    }
    .footer { 
      text-align: center; 
      padding: 30px 0; 
      opacity: 0.8;
    }
    .loading { opacity: 0.6; pointer-events: none; }
    
    @media (max-width: 768px) {
      .hero h1 { font-size: 36px; }
      .grid { grid-template-columns: 1fr; }
      .info-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="hero">
      <h1>ğŸ”§ WoodFlow</h1>
      <p>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø© - Powered by Supabase + Vercel</p>
    </div>

    <div class="grid">
      <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø§Ø¯Ù… -->
      <div class="card">
        <h3>
          ğŸŒ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø§Ø¯Ù…
          <span id="serverStatus" class="status-indicator status-loading"></span>
        </h3>
        <div style="margin-bottom: 15px;">
          <input type="url" id="serverUrl" placeholder="https://your-server.vercel.app" />
        </div>
        <div style="display: flex; gap: 10px;">
          <button class="btn btn-primary" id="saveServerBtn">ğŸ’¾ Ø­ÙØ¸</button>
          <button class="btn" id="testConnectionBtn">ğŸ” Ø§Ø®ØªØ¨Ø§Ø±</button>
        </div>
        <div id="connectionMessage" style="margin-top: 10px; font-size: 14px;"></div>
      </div>

      <!-- Ø¨Ø·Ø§Ù‚Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… -->
      <div class="card">
        <h3>ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„</div>
            <div class="info-value" id="connectionStatus">ØºÙŠØ± Ù…ØªØµÙ„</div>
          </div>
          <div class="info-item">
            <div class="info-label">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
            <div class="info-value" id="dbStatus">ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</div>
          </div>
          <div class="info-item">
            <div class="info-label">Ø¢Ø®Ø± ÙØ­Øµ</div>
            <div class="info-value" id="lastCheck">â€”</div>
          </div>
          <div class="info-item">
            <div class="info-label">ÙˆÙ‚Øª Ø§Ù„ØªØ´ØºÙŠÙ„</div>
            <div class="info-value" id="uptime">â€”</div>
          </div>
        </div>
      </div>

      <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙÙŠØ¯Ø© -->
      <div class="card">
        <h3>ğŸ”— Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙÙŠØ¯Ø©</h3>
        <div class="links-section">
          <a id="healthLink" href="#" target="_blank">ğŸ“¡ ÙØ­Øµ Ø§Ù„ØµØ­Ø© /api/health</a>
          <a id="syncLink" href="#" target="_blank">ğŸ”„ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© /api/sync</a>
          <a id="viewerLink" href="#" target="_blank">ğŸ“± Ø¹Ø§Ø±Ø¶ QR /viewer</a>
          <a id="updatesLink" href="#" target="_blank">ğŸ“¦ Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ« /updates</a>
        </div>
      </div>

      <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
      <div class="card">
        <h3>ğŸ“± Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹</h3>
        <div class="qr-container">
          <img id="qrCode" alt="QR Code" width="200" height="200" 
               src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=WoodFlow" />
          <div style="margin-top: 10px; font-size: 14px; opacity: 0.9;">
            Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ù„Ø¶Ø¨Ø· Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø¯Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
          </div>
        </div>
      </div>

      <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
      <div class="card">
        <h3>ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</h3>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù†Ø´Ø·Ø©</div>
            <div class="info-value" id="activeProjects">â€”</div>
          </div>
          <div class="info-item">
            <div class="info-label">Ø¢Ø®Ø± Ù…Ø²Ø§Ù…Ù†Ø©</div>
            <div class="info-value" id="lastSync">â€”</div>
          </div>
          <div class="info-item">
            <div class="info-label">Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
            <div class="info-value" id="dataSize">â€”</div>
          </div>
          <div class="info-item">
            <div class="info-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
            <div class="info-value" id="userCount">â€”</div>
          </div>
        </div>
      </div>

      <!-- Ø¨Ø·Ø§Ù‚Ø© Ø£Ø¯ÙˆØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
      <div class="card">
        <h3>âš¡ Ø£Ø¯ÙˆØ§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
        <div style="display: flex; flex-direction: column; gap: 10px;">
          <button class="btn" id="backupBtn">ğŸ’¾ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</button>
          <button class="btn" id="clearCacheBtn">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´</button>
          <button class="btn" id="exportDataBtn">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
          <button class="btn btn-primary" id="deployUpdatesBtn">ğŸš€ Ù†Ø´Ø± ØªØ­Ø¯ÙŠØ«</button>
        </div>
      </div>
    </div>

    <div class="footer">
      <p>ğŸ”§ WoodFlow Control Panel - Built with â¤ï¸ using Supabase & Vercel</p>
      <p style="font-size: 14px; opacity: 0.7;">Ù…Ø¬Ø§Ù†ÙŠ 100% â€¢ ÙŠØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ 24/7 â€¢ Ø¨Ø¯ÙˆÙ† ØµÙŠØ§Ù†Ø©</p>
    </div>
  </div>

  <script>
    // Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© JavaScript Ù‡Ù†Ø§
    console.log('ğŸš€ WoodFlow Control Panel Loading...');
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
    let currentServerUrl = localStorage.getItem('woodflow_server_url') || '';
    
    // Ø¹Ù†Ø§ØµØ± DOM
    const serverUrlInput = document.getElementById('serverUrl');
    const saveServerBtn = document.getElementById('saveServerBtn');
    const testConnectionBtn = document.getElementById('testConnectionBtn');
    const serverStatus = document.getElementById('serverStatus');
    const connectionMessage = document.getElementById('connectionMessage');
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
    function updateLinks(baseUrl) {
      if (!baseUrl) return;
      
      document.getElementById('healthLink').href = baseUrl + '/api/health';
      document.getElementById('syncLink').href = baseUrl + '/api/sync';
      document.getElementById('viewerLink').href = baseUrl + '/viewer';
      document.getElementById('updatesLink').href = baseUrl + '/updates';
      
      // ØªØ­Ø¯ÙŠØ« QR Code
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(baseUrl)}`;
      document.getElementById('qrCode').src = qrUrl;
    }
    
    // Ø­ÙØ¸ Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø¯Ù…
    function saveServerUrl() {
      const url = serverUrlInput.value.trim();
      if (!url) {
        showMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
        return;
      }
      
      try {
        new URL(url); // ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ø§Ø¨Ø·
        currentServerUrl = url;
        localStorage.setItem('woodflow_server_url', url);
        updateLinks(url);
        showMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­', 'success');
        testConnection();
      } catch (e) {
        showMessage('Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
      }
    }
    
    // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
    async function testConnection() {
      if (!currentServerUrl) {
        showMessage('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ø®Ø§Ø¯Ù… Ù…Ø­ÙÙˆØ¸', 'error');
        return;
      }
      
      serverStatus.className = 'status-indicator status-loading';
      showMessage('Ø¬Ø§Ø±Ù Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...', 'info');
      
      try {
        const response = await fetch(currentServerUrl + '/api/health', {
          method: 'GET',
          cache: 'no-store'
        });
        
        if (response.ok) {
          const data = await response.json();
          serverStatus.className = 'status-indicator status-online';
          showMessage('âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø¬Ø­! Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ', 'success');
          updateDashboard(data);
        } else {
          throw new Error('Server returned ' + response.status);
        }
      } catch (error) {
        serverStatus.className = 'status-indicator status-offline';
        showMessage('âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message, 'error');
      }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
    function updateDashboard(healthData) {
      document.getElementById('connectionStatus').textContent = 'Ù…ØªØµÙ„ âœ…';
      document.getElementById('dbStatus').textContent = healthData.database || 'ÙŠØ¹Ù…Ù„';
      document.getElementById('lastCheck').textContent = new Date().toLocaleTimeString('ar');
      document.getElementById('uptime').textContent = healthData.uptime || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
    }
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    function showMessage(message, type = 'info') {
      const messageDiv = connectionMessage;
      messageDiv.textContent = message;
      messageDiv.style.color = type === 'error' ? '#ff4757' : 
                               type === 'success' ? '#00ff88' : 
                               '#ffa502';
    }
    
    // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    saveServerBtn.addEventListener('click', saveServerUrl);
    testConnectionBtn.addEventListener('click', testConnection);
    serverUrlInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') saveServerUrl();
    });
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
    function init() {
      if (currentServerUrl) {
        serverUrlInput.value = currentServerUrl;
        updateLinks(currentServerUrl);
        // Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
        setTimeout(testConnection, 2000);
      }
      
      // ÙØ­Øµ Ø¯ÙˆØ±ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
      setInterval(() => {
        if (currentServerUrl) testConnection();
      }, 60000);
    }
    
    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    init();
    
    console.log('âœ… WoodFlow Control Panel Ready!');
  </script>
</body>
</html>